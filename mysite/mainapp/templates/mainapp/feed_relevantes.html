{% extends 'mainapp/base.html' %}
{% load static %}

{% block titulo %}Pratiler | Feed Relevantes{% endblock %}
{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/postar_comentario.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/feed_geral.css' %}">
    <script>
        function atualizarPagina(){
            document.getElementById('livro-select').addEventListener('change', function() {
                var selectedOption = this.options[this.selectedIndex];
                var ultimaPagina = selectedOption.getAttribute('ultima-pagina');
                console.log("Livro selecionado:", selectedOption.text);
                console.log("Última página lida:", ultimaPagina)
                document.getElementById('pagina-inicial').placeholder = ultimaPagina;
            });
        }
    </script>
{% endblock %}
{% block conteudo %}
    <h1>PraTiLer | Feed Relevantes </h1>
    <main>
        <form method="post" action="{% url 'feed' %}">
        {% csrf_token %}
            {% if livros %}
            <select id="livro-select" name="livro" onchange="atualizarPagina()">
                {% for l in livros %}
                {% with ultima_pagina=l.livro.comentario_set.last.pagina_final %}
                <option value="{{l.livro.id}}" ultima-pagina="{{ ultima_pagina }}">{{ l.livro.titulo }}</option>
                {% endwith %}
                {% endfor %}
            </select>
            {% endif %}
            <label>
                Da página: <input type="number" name="pagina-inicial" id="pagina-inicial" min="0" readonly> 
                Até a página: <input type="number" name="pagina-final" min="1" max="{{l.livro.n_paginas}}">
            </label>
            <textarea name="conteudo">Escreva seu comentário...</textarea>
            <input type='submit' value='Postar'>
        </form>
        {% if comentarios_relevantes %}
        <ul>
            {% for comentario in comentarios_relevantes %}
                {% include 'mainapp/comentario.html' %}
            {% endfor %}
        </ul>
    {% else %}
        <p>Não há comentários relevantes no momento.</p>
    {% endif %}
    </main>
{% endblock %}

